<div class="flex flex-col items-center justify-center p-8">
  <div class="bg-gray-700 rounded-lg p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold text-center mb-6">üîê Connect to Nostr</h2>

    <form
      id="login-form"
      hx-post="/login"
      hx-swap="none"
      _="on htmx:beforeRequest 
               call showLoginResult('loading', 'Connecting...')
           on htmx:afterRequest
               if event.detail.xhr.status == 200
                 call showLoginResult('success', 'Login successful! Redirecting...')
                 wait 1s
                 htmx.ajax('GET', '/views/profile.html', '#main-content')
                 htmx.pushUrl('/profile')
                 send updateNav to body
               else
                 call showLoginResult('error', 'Login failed: ' + event.detail.xhr.responseText)
               end"
    >
      <div class="mb-4">
        <label
          for="publicKey"
          class="block text-sm font-medium text-gray-300 mb-2"
        >
          Public Key (npub or hex)
        </label>
        <input
          type="text"
          id="publicKey"
          name="publicKey"
          required
          placeholder="npub1... or hex key"
          class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
          _="on input 
                   set value to my.value.trim()
                   if value.length > 0
                     if value.startsWith('npub1') and value.length == 63
                       add .border-green-500 to me
                       remove .border-red-500 from me
                       remove .border-gray-500 from me
                     else if value.length == 64 and call isValidHex(value)
                       add .border-green-500 to me
                       remove .border-red-500 from me
                       remove .border-gray-500 from me
                     else
                       add .border-red-500 to me
                       remove .border-green-500 from me
                       remove .border-gray-500 from me
                     end
                   else
                     remove .border-green-500 from me
                     remove .border-red-500 from me
                     add .border-gray-500 to me
                   end"
        />
      </div>

      <button
        type="submit"
        class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition-colors"
      >
        Connect
      </button>
    </form>

    <div id="login-result" class="mt-4">
      <!-- Login results will appear here -->
    </div>

    <div class="mt-6 text-center text-sm text-gray-400">
      <p class="mb-2">Need a Nostr account?</p>
      <div class="space-x-4">
        <a
          href="https://damus.io"
          target="_blank"
          class="text-purple-400 hover:underline"
          >Damus</a
        >
        <a
          href="https://iris.to"
          target="_blank"
          class="text-purple-400 hover:underline"
          >Iris</a
        >
        <a
          href="https://primal.net"
          target="_blank"
          class="text-purple-400 hover:underline"
          >Primal</a
        >
      </div>
    </div>

    <div class="mt-4 text-center">
      <button
        class="text-gray-400 hover:text-white text-sm underline"
        hx-get="/views/home.html"
        hx-target="#main-content"
        hx-push-url="/"
      >
        ‚Üê Back to Home
      </button>
    </div>
  </div>
</div>

<script>
  function showLoginResult(type, message) {
    let className, icon;

    if (type === "success") {
      className = "bg-green-800 border-green-600 text-green-200";
      icon = "‚úÖ";
    } else if (type === "error") {
      className = "bg-red-800 border-red-600 text-red-200";
      icon = "‚ùå";
    } else if (type === "loading") {
      className = "bg-blue-800 border-blue-600 text-blue-200";
      icon = "‚è≥";
    } else {
      className = "bg-gray-800 border-gray-600 text-gray-200";
      icon = "‚ÑπÔ∏è";
    }

    const resultDiv = document.getElementById("login-result");
    if (resultDiv) {
      resultDiv.innerHTML = `<div class="${className} border px-4 py-3 rounded"><p>${icon} ${message}</p></div>`;
    }
  }

  // Helper function for hex validation that Hyperscript can call
  function isValidHex(value) {
    return /^[0-9a-fA-F]+$/.test(value);
  }
</script>
