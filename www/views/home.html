<!-- GRAIN Relay Dashboard Home View - Phase 1 Redesign with Layout Fixes -->
<div id="dashboard-main" class="min-h-screen p-4 text-white">
  <!-- Compact Dashboard Header -->
  <div class="pb-4 mb-6 border-b border-gray-700">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="mb-1 text-2xl font-bold text-white">
          🌾 GRAIN Relay Dashboard
        </h1>
        <p class="text-sm text-gray-400">
          Relay management and system overview
        </p>
      </div>
      <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-2">
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-sm font-medium text-green-400">Relay Online</span>
        </div>
      </div>
    </div>
    <div class="mt-2 text-xs text-gray-500">
      Last updated: <span id="last-updated">Loading...</span>
    </div>
  </div>

  <!-- Whitelist and Blacklist Containers with Fixed Layout -->
  <div class="mb-8 grid-container">
    <!-- Whitelist Container (Larger - 2/3 width) -->
    <div class="overflow-hidden bg-gray-800 border border-gray-700 rounded-lg">
      <div class="px-4 py-3 border-b border-gray-700 bg-gray-750">
        <h2 class="text-lg font-semibold text-white">⬜ Whitelist</h2>
        <p class="text-xs text-gray-400">Approved users and configuration</p>
      </div>

      <!-- Whitelist Configuration Section with Improved Layout -->
      <div class="p-4 border-b border-gray-700">
        <h3 class="mb-4 text-base font-medium text-center text-white">
          Configuration
        </h3>
        <div id="whitelist-config" class="space-y-3">
          <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        </div>
      </div>

      <!-- Whitelist Keys Section -->
      <div class="p-4">
        <h3 class="mb-3 text-base font-medium text-white">Whitelisted Users</h3>
        <div id="whitelist-keys" class="space-y-3">
          <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        </div>
      </div>
    </div>

    <!-- Blacklist Container (Smaller - 1/3 width) -->
    <div class="overflow-hidden bg-gray-800 border border-gray-700 rounded-lg">
      <div class="px-4 py-3 border-b border-gray-700 bg-gray-750">
        <h2 class="text-lg font-semibold text-white">⬛ Blacklist</h2>
        <p class="text-xs text-gray-400">Blocked users and configuration</p>
      </div>

      <!-- Blacklist Configuration Section -->
      <div class="p-4 border-b border-gray-700">
        <h3 class="mb-3 text-base font-medium text-white">Configuration</h3>
        <div id="blacklist-config" class="space-y-3">
          <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        </div>
      </div>

      <!-- Blacklist Keys Section -->
      <div class="p-4">
        <h3 class="mb-3 text-base font-medium text-white">Blocked Users</h3>
        <div id="blacklist-keys" class="space-y-3">
          <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
          <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 1. Relay Overview Section -->
  <div
    class="mb-8 overflow-hidden bg-gray-800 border border-gray-700 rounded-lg"
  >
    <div class="px-6 py-4 border-b border-gray-700 bg-gray-750">
      <h2 class="text-xl font-semibold text-white">📊 Relay Overview</h2>
      <p class="text-sm text-gray-400">Basic relay information and identity</p>
    </div>
    <div id="relay-overview-content" class="p-6">
      <div class="space-y-3">
        <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
        <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
      </div>
    </div>
  </div>

  <!-- 2. Policy & Limits Section -->
  <div
    class="mb-8 overflow-hidden bg-gray-800 border border-gray-700 rounded-lg"
  >
    <div class="px-6 py-4 border-b border-gray-700 bg-gray-750">
      <h2 class="text-xl font-semibold text-white">⚙️ Policy & Limits</h2>
      <p class="text-sm text-gray-400">
        Rate limits, event constraints, and operational policies
      </p>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-750">
          <tr>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Policy Type
            </th>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Limit/Value
            </th>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Burst/Additional
            </th>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Status
            </th>
          </tr>
        </thead>
        <tbody
          id="policy-limits-table"
          class="bg-gray-800 divide-y divide-gray-700"
        >
          <!-- Loading placeholder -->
          <tr>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="w-32 h-4 bg-gray-700 rounded animate-pulse"></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="w-20 h-4 bg-gray-700 rounded animate-pulse"></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="w-24 h-4 bg-gray-700 rounded animate-pulse"></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div
                class="w-16 h-6 bg-gray-700 rounded-full animate-pulse"
              ></div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- 3. Event Purge Management Section -->
  <div
    class="mb-8 overflow-hidden bg-gray-800 border border-gray-700 rounded-lg"
  >
    <div class="px-6 py-4 border-b border-gray-700 bg-gray-750">
      <h2 class="text-xl font-semibold text-white">
        🗑️ Event Purge Management
      </h2>
      <p class="text-sm text-gray-400">Event retention and cleanup policies</p>
    </div>
    <div id="event-purge-content" class="p-6">
      <div class="space-y-3">
        <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
        <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
      </div>
    </div>
  </div>

  <!-- 4. System Configuration Section -->
  <div
    class="mb-8 overflow-hidden bg-gray-800 border border-gray-700 rounded-lg"
  >
    <div class="px-6 py-4 border-b border-gray-700 bg-gray-750">
      <h2 class="text-xl font-semibold text-white">🔐 System Configuration</h2>
      <p class="text-sm text-gray-400">
        Authentication and infrastructure settings
      </p>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-750">
          <tr>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Setting
            </th>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Value
            </th>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Description
            </th>
            <th
              class="px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-300 uppercase"
            >
              Status
            </th>
          </tr>
        </thead>
        <tbody
          id="system-config-table"
          class="bg-gray-800 divide-y divide-gray-700"
        >
          <!-- Loading placeholder -->
          <tr>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="w-24 h-4 bg-gray-700 rounded animate-pulse"></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="w-16 h-4 bg-gray-700 rounded animate-pulse"></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="w-40 h-4 bg-gray-700 rounded animate-pulse"></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div
                class="w-16 h-6 bg-gray-700 rounded-full animate-pulse"
              ></div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- 5. User Sync (Experimental) Section - Collapsible -->
  <div
    class="mb-8 overflow-hidden bg-gray-800 border border-gray-700 rounded-lg"
  >
    <div
      class="px-6 py-4 transition-colors border-b border-gray-700 cursor-pointer bg-gray-750 hover:bg-gray-700"
      onclick="toggleUserSyncSection()"
    >
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold text-white">
            🔄 User Sync
            <span class="text-sm font-normal text-orange-400"
              >(Experimental)</span
            >
          </h2>
          <p class="text-sm text-gray-400">
            User data synchronization settings
          </p>
        </div>
        <svg
          id="user-sync-chevron"
          class="w-5 h-5 text-gray-400 transition-transform duration-200 transform"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </div>
    </div>
    <div id="user-sync-content" class="hidden p-6">
      <div class="space-y-3">
        <div class="h-4 bg-gray-700 rounded animate-pulse"></div>
        <div class="w-5/6 h-4 bg-gray-700 rounded animate-pulse"></div>
        <div class="w-4/6 h-4 bg-gray-700 rounded animate-pulse"></div>
      </div>
    </div>
  </div>
</div>

<!-- Hyperscript for simple interactions -->
<div></div>

<script>
  // Toggle User Sync section visibility
  function toggleUserSyncSection() {
    const content = document.getElementById("user-sync-content");
    const chevron = document.getElementById("user-sync-chevron");

    if (content.classList.contains("hidden")) {
      content.classList.remove("hidden");
      chevron.style.transform = "rotate(90deg)";
    } else {
      content.classList.add("hidden");
      chevron.style.transform = "rotate(0deg)";
    }
  }
</script>

<style>
  /* Fix initial width issues by setting explicit container width */
  #dashboard-main {
    width: 100%;
    max-width: none;
    min-height: 100vh;
  }

  /* Prevent width flicker during load */
  .grid-container {
    width: 100%;
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  @media (min-width: 1024px) {
    .grid-container {
      grid-template-columns: 2fr 1fr;
    }
  }

  /* Custom scrollbar for better aesthetics */
  .custom-scroll {
    scrollbar-width: thin;
    scrollbar-color: #4b5563 #1f2937;
  }

  .custom-scroll::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .custom-scroll::-webkit-scrollbar-track {
    background: #1f2937;
    border-radius: 4px;
  }

  .custom-scroll::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 4px;
    border: 1px solid #374151;
  }

  .custom-scroll::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
  }

  /* Ensure consistent grid behavior */
  .whitelist-config-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    width: 100%;
  }

  @media (max-width: 768px) {
    .whitelist-config-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
<script src="/static/js/dashboard.js"></script>
<script>
  // Safe initialization that waits for both DOM and script to be ready
  function safeInitializeDashboard() {
    // Check if the dashboard.js file has loaded and the function exists
    if (
      typeof newDashboardManager !== "undefined" &&
      newDashboardManager &&
      typeof newDashboardManager.init === "function" &&
      document.getElementById("last-updated") &&
      document.getElementById("whitelist-config")
    ) {
      console.log("Initializing dashboard...");
      newDashboardManager.init();
    } else {
      console.log("Waiting for dashboard.js to load...");
      // Wait a bit more for script to load
      setTimeout(safeInitializeDashboard, 100);
    }
  }

  // Initialize dashboard when page loads via any navigation method
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", safeInitializeDashboard);
  } else {
    // Give the script tag time to load
    setTimeout(safeInitializeDashboard, 10);
  }
</script>
