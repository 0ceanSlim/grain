{{define "header"}}
<header
  class="flex items-center justify-between mx-4 mt-8 mb-8"
  hx-boost="true"
>
  <h1
    class="text-3xl font-bold cursor-pointer"
    hx-get="/views/home.html"
    hx-target="#main-content"
    hx-push-url="/"
  >
    ğŸŒ¾ grain
  </h1>

  <nav class="flex items-center space-x-4">
    <button
      class="text-gray-300 hover:text-white px-3 py-2 rounded transition-colors"
      hx-get="/views/home.html"
      hx-target="#main-content"
      hx-push-url="/"
    >
      ğŸ  Home
    </button>

    <div id="profile-nav">{{template "login-button"}}</div>
  </nav>
</header>

<!-- Hidden templates -->
<div class="hidden">
  {{template "login-button"}} {{template "profile-button"}} {{template
  "logout-button"}}
</div>

<div
  _="
  def updateNavigation()
    fetch '/api/v1/session' then
      if the result's ok
        get #profile-template then
        get the first <button/> in it then
        put it into #profile-nav then
        get #logout-template then
        get the first <button/> in it then
        put it after the last <button/> in #profile-nav then
        htmx.process(#profile-nav)
      else
        get #login-template then
        get the first <button/> in it then
        put it into #profile-nav then
        htmx.process(#profile-nav)
      end
  end

  def logoutUser()
    if confirm('Are you sure you want to logout?')
      fetch '/logout' with method:'POST' then
        if the result's ok
          htmx.ajax('GET', '/views/home.html', '#main-content')
          htmx.pushUrl('/')
          call updateNavigation()
        end
    end
  end

  on load call updateNavigation()
  on updateNav call updateNavigation()
"
></div>
{{end}}
